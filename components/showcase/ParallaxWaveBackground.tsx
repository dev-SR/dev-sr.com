'use client';

import { useEffect, useRef } from 'react';
import { useGSAP } from '@gsap/react';
import gsap from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';
import { useWindowScroll } from '@uidotdev/usehooks';

// Register only ScrollTrigger as a plugin
gsap.registerPlugin(ScrollTrigger);

export default function ParallaxWaves() {
  const waveTimelinesRef = useRef<gsap.core.Timeline[]>([]);
  const [{ x, y }, scrollTo] = useWindowScroll();

  useEffect(() => {
    // Pause waves while scrolling
    if (waveTimelinesRef.current?.length) {
      waveTimelinesRef.current?.forEach((tl) => {
        if (y !== 0) {
          tl.pause();
        } else {
          tl.play();
        }
      });
    }
  }, [y]);

  useGSAP(() => {
    const sections = gsap.utils.toArray<HTMLElement>('.wave-layer');

    waveTimelinesRef.current = sections.map((layer, i) => {
      if (i === sections.length - 1) return gsap.timeline(); // Skip the last layer for wave animation
      const tl = gsap.timeline({ repeat: -1, yoyo: true });
      tl.to(layer, {
        y: -20 + i * 2,
        duration: 2 + i * 0.5,
        ease: 'sine.inOut',
        delay: 0.3,
      });
      return tl;
    });

    // Parallax effect
    sections.forEach((layer, i) => {
      if (i === sections.length - 1) return; // Skip the last layer for parallax
      const depth = (i + 1) * 100; // Adjust depth factor as needed
      gsap.to(layer, {
        yPercent: depth,
        ease: 'none', // Linear ease for smooth parallax
        scrollTrigger: {
          trigger: document.body,
          start: 'top top',
          end: 'top 20%',
          scrub: 1,
        },
      });
    });
  });

  return (
    <div
      className={
        'relative bg-linear-to-b from-background to-[#366d93] to-80% w-full h-[70vh] overflow-hidden'
      }>
      <div
        className={
          'absolute inset-x-0 top-0 h-full mt-5 overflow-hidden flex flex-col items-center justify-center z-10'
        }>
        <svg
          width="5180"
          height="402"
          viewBox="0 0 5180 402"
          fill="none"
          className="min-w-[320rem] w-full wave-layer"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M2498.4 198.349C2510.33 198.349 2539.9 148.849 2723.7 167.349C2887.17 183.803 2921.4 276.269 2971.85 271.349C3009.9 267.639 3056.9 66.4564 3239.44 55.8493C3395.9 46.7571 3438.77 123.349 3450.9 123.849C3463.03 124.349 3480.29 83.3493 3595.72 83.3493C3759.4 83.3493 3799.07 198.85 3810.48 198.349C3821.9 197.849 3839.4 45.3493 4076.08 45.3493C4269.9 45.3493 4276.72 120.849 4287.9 116.849C4299.09 112.849 4308.4 13.8493 4449.3 13.8493C4598.4 13.8493 4622.14 115.849 4639.9 116.849C4657.66 117.849 4671.9 13.8498 4826.4 13.8495C4977.4 13.8493 4985.83 76.8494 5001.91 76.8494C5018 76.8494 5014.4 8.84912 5108.4 8.84912C5178.53 8.84912 5180.02 63.1148 5179.54 74.6928C5179.48 76.1566 5179.4 77.5835 5179.4 79.0485V360.349V361.849C5179.4 383.941 5161.49 401.849 5139.4 401.849H40.4045C18.3131 401.849 0.404541 383.941 0.404541 361.849V133.849V76.3512V76.3493C0.404541 76.3095 0.412041 0.349043 55.4045 0.349121C135.152 0.349234 164.022 68.3208 174.474 117.535C179.818 142.696 204.332 161.83 229.395 156.049L509.905 91.3491C629.905 64.8491 677.405 110.849 690.405 110.849C703.405 110.849 745.405 31.3491 887.405 33.8491C1029.4 36.3491 1027.9 76.3491 1039.9 73.8491C1051.9 71.3491 1045.68 28.382 1205.9 31.3491C1340.9 33.8491 1329.9 110.849 1358.9 110.849C1397.71 110.849 1409.65 109.806 1419.4 110.849C1438.09 112.849 1460.9 27.3491 1646.4 27.3491C1775.14 27.3491 1802.49 161.532 1886.56 167.349C1961.68 172.547 1945.9 85.3491 2063.45 90.3493C2140.33 93.6193 2163.73 148.349 2177.56 148.349C2191.4 148.349 2215.4 82.0146 2349.48 102.849C2471.9 121.873 2486.47 198.349 2498.4 198.349Z"
            fill="#3a577d"
          />
        </svg>
      </div>
      <div
        className={
          'absolute inset-x-0 bottom-0 -mt-5 h-full overflow-hidden flex flex-col items-center justify-end z-20'
        }>
        <svg
          width="5151"
          height="357"
          viewBox="0 0 5151 357"
          fill="none"
          className="min-w-[320rem] w-full wave-layer"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M2617.95 166.201C2497.94 161.966 2430.67 208.309 2401.48 235.933C2389.38 247.378 2373.78 255.701 2357.13 255.701H2136.58C2112.01 255.701 2090.9 237.905 2083.74 214.399C2062.52 144.705 2002.48 10.5601 1853.7 3.20124C1691.95 -4.79906 1645.95 117.201 1622.95 118.701C1599.95 120.201 1587.95 20.7009 1369.45 20.7009C1211.95 20.7009 1180.95 89.7009 1159.35 93.7009C1137.76 97.7019 1075.28 43.2009 931.955 61.7009C788.626 80.2009 790.631 146.701 770.955 146.201C751.279 145.701 737.455 61.7009 535.984 74.7009C417.818 82.3259 383.118 143.271 374.624 192.367C369.096 224.324 344.376 255.701 311.945 255.701H280.979C250.034 255.701 226.007 227.704 225.286 196.768C223.687 128.181 201.26 24.2009 79.955 24.2009C18.4288 24.2009 4.43478 60.5709 1.60805 71.5809C1.07732 73.6479 0.954956 75.7719 0.954956 77.9059V330.201C0.954956 344.561 12.5954 356.201 26.9548 356.201H5100.95C5128.56 356.201 5150.95 333.816 5150.95 306.201V297.201V114.052C5150.95 81.5819 5120.49 57.7149 5088.85 64.9739C5055.62 72.5929 5019.97 80.2089 5012.27 79.7009C4997.06 78.7019 4967.37 32.108 4860.39 27.7012C4731.95 22.4105 4684.95 145.701 4663.95 145.701H4532.79C4514.43 145.701 4497.59 135.636 4486.62 120.916C4452.76 75.4869 4366.04 -14.8864 4221.62 3.20124C4061.95 23.2011 4024.45 82.7009 4007.45 82.7009C3990.45 82.7009 3926.56 28.7101 3798.45 32.7009C3637.95 37.7009 3599.95 167.701 3589.95 163.701C3564.08 153.349 3431.27 124.797 3406.33 112.346C3383.91 101.155 3355.57 93.7009 3319.83 93.7009C3176.39 93.7009 3130.69 156.201 3117.83 156.201C3104.95 156.201 3074.58 111.701 2954.45 111.701C2782.95 111.701 2772.87 218.201 2756.95 216.701C2741.04 215.201 2722.06 169.875 2617.95 166.201Z"
            fill="#172231"
          />
        </svg>
      </div>
      <div
        className={
          'translate-y-2 absolute inset-x-0 bottom-0 h-full overflow-hidden flex flex-col items-center justify-end z-30'
        }>
        <svg
          width="5191"
          height="429"
          className="min-w-[320rem] w-full wave-layer"
          viewBox="0 0 5191 429"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M2684.9 374.459C2656.81 372.958 2569.25 170.959 2164.51 170.959C1905.5 170.959 1883.5 237.459 1850.38 232.459C1817.27 227.458 1766.84 102.95 1605.67 108.959C1444.5 114.968 1410.08 286.459 1382.5 293.959C1354.92 301.459 1322.5 199.459 1078.29 207.459C846.49 215.052 767.797 291.459 740.5 285.959C713.203 280.459 724.5 48.9586 473.996 5.45861C257.804 -32.083 143.246 156.896 104.139 239.434C94.9353 258.859 71.4703 268.351 52.0729 259.088C28.1527 247.664 0.5 265.103 0.5 291.611V402.459C0.5 416.818 12.1408 428.459 26.5001 428.459H5146.5C5170.8 428.459 5190.5 408.759 5190.5 384.459V205.849C5190.5 199.602 5189.96 193.363 5188.05 187.416C5180.42 163.688 5152.2 101.459 5066 101.459C4924.5 101.459 4978.5 226.663 4882.33 221.959C4851.66 220.458 4800.77 28.4594 4578.5 31.959C4356.23 35.4586 4327.48 243.459 4294 241.459C4260.52 239.459 4240.5 171.959 4080.77 162.459C3878.26 150.414 3834.36 257.959 3797 251.959C3759.64 245.959 3696.46 71.7828 3421 126.459C3199.96 170.333 3235 360.439 3183.32 349.459C3162.14 344.958 3122 311.959 2991.53 311.959C2937.7 311.959 2933.87 303.635 2880.69 311.959C2752 332.1 2713 375.959 2684.9 374.459Z"
            fill="#0d0f12"
          />
        </svg>
      </div>
    </div>
  );
}
